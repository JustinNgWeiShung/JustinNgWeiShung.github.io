var fe=Object.defineProperty;var de=(e,t,i)=>t in e?fe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var g=(e,t,i)=>de(e,typeof t!="symbol"?t+"":t,i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(n){if(n.ep)return;n.ep=!0;const l=i(n);fetch(n.href,l)}})();const he=(e,t)=>e===t,Z={equals:he};let pe=ie;const b=1,O=2,z={owned:null,cleanups:null,context:null,owner:null};var h=null;let D=null,ge=null,a=null,f=null,v=null,I=0;function Se(e,t){const i=a,r=h,n=e.length===0,l=t===void 0?r:t,o=n?z:{owned:null,cleanups:null,context:l?l.context:null,owner:l},s=n?e:()=>e(()=>x(()=>P(o)));h=o,a=null;try{return C(s,!0)}finally{a=i,h=r}}function N(e,t,i){const r=ee(e,t,!1,b);U(r)}function H(e,t,i){i=i?Object.assign({},Z,i):Z;const r=ee(e,t,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=i.equals||void 0,U(r),ye.bind(r)}function x(e){if(a===null)return e();const t=a;a=null;try{return e()}finally{a=t}}function ye(){if(this.sources&&this.state)if(this.state===b)U(this);else{const e=f;f=null,C(()=>B(this),!1),f=e}if(a){const e=this.observers?this.observers.length:0;a.sources?(a.sources.push(this),a.sourceSlots.push(e)):(a.sources=[this],a.sourceSlots=[e]),this.observers?(this.observers.push(a),this.observerSlots.push(a.sources.length-1)):(this.observers=[a],this.observerSlots=[a.sources.length-1])}return this.value}function ve(e,t,i){let r=e.value;return(!e.comparator||!e.comparator(r,t))&&(e.value=t,e.observers&&e.observers.length&&C(()=>{for(let n=0;n<e.observers.length;n+=1){const l=e.observers[n],o=D&&D.running;o&&D.disposed.has(l),(o?!l.tState:!l.state)&&(l.pure?f.push(l):v.push(l),l.observers&&re(l)),o||(l.state=b)}if(f.length>1e6)throw f=[],new Error},!1)),t}function U(e){if(!e.fn)return;P(e);const t=I;be(e,e.value,t)}function be(e,t,i){let r;const n=h,l=a;a=h=e;try{r=e.fn(t)}catch(o){return e.pure&&(e.state=b,e.owned&&e.owned.forEach(P),e.owned=null),e.updatedAt=i+1,ne(o)}finally{a=l,h=n}(!e.updatedAt||e.updatedAt<=i)&&(e.updatedAt!=null&&"observers"in e?ve(e,r):e.value=r,e.updatedAt=i)}function ee(e,t,i,r=b,n){const l={fn:e,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:h,context:h?h.context:null,pure:i};return h===null||h!==z&&(h.owned?h.owned.push(l):h.owned=[l]),l}function te(e){if(e.state===0)return;if(e.state===O)return B(e);if(e.suspense&&x(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<I);)e.state&&t.push(e);for(let i=t.length-1;i>=0;i--)if(e=t[i],e.state===b)U(e);else if(e.state===O){const r=f;f=null,C(()=>B(e,t[0]),!1),f=r}}function C(e,t){if(f)return e();let i=!1;t||(f=[]),v?i=!0:v=[],I++;try{const r=e();return me(i),r}catch(r){i||(v=null),f=null,ne(r)}}function me(e){if(f&&(ie(f),f=null),e)return;const t=v;v=null,t.length&&C(()=>pe(t),!1)}function ie(e){for(let t=0;t<e.length;t++)te(e[t])}function B(e,t){e.state=0;for(let i=0;i<e.sources.length;i+=1){const r=e.sources[i];if(r.sources){const n=r.state;n===b?r!==t&&(!r.updatedAt||r.updatedAt<I)&&te(r):n===O&&B(r,t)}}}function re(e){for(let t=0;t<e.observers.length;t+=1){const i=e.observers[t];i.state||(i.state=O,i.pure?f.push(i):v.push(i),i.observers&&re(i))}}function P(e){let t;if(e.sources)for(;e.sources.length;){const i=e.sources.pop(),r=e.sourceSlots.pop(),n=i.observers;if(n&&n.length){const l=n.pop(),o=i.observerSlots.pop();r<n.length&&(l.sourceSlots[o]=r,n[r]=l,i.observerSlots[r]=o)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)P(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)P(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function we(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function ne(e,t=h){throw we(e)}function V(e,t){return x(()=>e(t||{}))}const Ae=e=>`Stale read from <${e}>.`;function Ee(e){const t=e.keyed,i=H(()=>e.when,void 0,{equals:(r,n)=>t?r===n:!r==!n});return H(()=>{const r=i();if(r){const n=e.children;return typeof n=="function"&&n.length>0?x(()=>n(t?r:()=>{if(!x(i))throw Ae("Show");return e.when})):n}return e.fallback},void 0,void 0)}function xe(e,t,i){let r=i.length,n=t.length,l=r,o=0,s=0,u=t[n-1].nextSibling,c=null;for(;o<n||s<l;){if(t[o]===i[s]){o++,s++;continue}for(;t[n-1]===i[l-1];)n--,l--;if(n===o){const d=l<r?s?i[s-1].nextSibling:i[l-s]:u;for(;s<l;)e.insertBefore(i[s++],d)}else if(l===s)for(;o<n;)(!c||!c.has(t[o]))&&t[o].remove(),o++;else if(t[o]===i[l-1]&&i[s]===t[n-1]){const d=t[--n].nextSibling;e.insertBefore(i[s++],t[o++].nextSibling),e.insertBefore(i[--l],d),t[n]=i[l]}else{if(!c){c=new Map;let S=s;for(;S<l;)c.set(i[S],S++)}const d=c.get(t[o]);if(d!=null)if(s<d&&d<l){let S=o,y=1,G;for(;++S<n&&S<l&&!((G=c.get(t[S]))==null||G!==d+y);)y++;if(y>d-s){const w=t[o];for(;s<d;)e.insertBefore(i[s++],w)}else e.replaceChild(i[s++],t[o++])}else o++;else t[o++].remove()}}}const K="_$DX_DELEGATE";function Pe(e,t,i,r={}){let n;return Se(l=>{n=l,t===document?e():M(t,e(),t.firstChild?null:void 0,i)},r.owner),()=>{n(),t.textContent=""}}function L(e,t,i){let r;const n=()=>{const o=document.createElement("template");return o.innerHTML=e,o.content.firstChild},l=()=>(r||(r=n())).cloneNode(!0);return l.cloneNode=l,l}function Ce(e,t=window.document){const i=t[K]||(t[K]=new Set);for(let r=0,n=e.length;r<n;r++){const l=e[r];i.has(l)||(i.add(l),t.addEventListener(l,Ge))}}function M(e,t,i,r){if(i!==void 0&&!r&&(r=[]),typeof t!="function")return _(e,t,r,i);N(n=>_(e,t(),n,i),r)}function Ge(e){let t=e.target;const i=`$$${e.type}`,r=e.target,n=e.currentTarget,l=u=>Object.defineProperty(e,"target",{configurable:!0,value:u}),o=()=>{const u=t[i];if(u&&!t.disabled){const c=t[`${i}Data`];if(c!==void 0?u.call(t,c,e):u.call(t,e),e.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(e.target)&&l(t.host),!0},s=()=>{for(;o()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return t||document}}),e.composedPath){const u=e.composedPath();l(u[0]);for(let c=0;c<u.length-2&&(t=u[c],!!o());c++){if(t._$host){t=t._$host,s();break}if(t.parentNode===n)break}}else s();l(r)}function _(e,t,i,r,n){for(;typeof i=="function";)i=i();if(t===i)return i;const l=typeof t,o=r!==void 0;if(e=o&&i[0]&&i[0].parentNode||e,l==="string"||l==="number"){if(l==="number"&&(t=t.toString(),t===i))return i;if(o){let s=i[0];s&&s.nodeType===3?s.data!==t&&(s.data=t):s=document.createTextNode(t),i=m(e,i,r,s)}else i!==""&&typeof i=="string"?i=e.firstChild.data=t:i=e.textContent=t}else if(t==null||l==="boolean")i=m(e,i,r);else{if(l==="function")return N(()=>{let s=t();for(;typeof s=="function";)s=s();i=_(e,s,i,r)}),()=>i;if(Array.isArray(t)){const s=[],u=i&&Array.isArray(i);if(F(s,t,i,n))return N(()=>i=_(e,s,i,r,!0)),()=>i;if(s.length===0){if(i=m(e,i,r),o)return i}else u?i.length===0?J(e,s,r):xe(e,i,s):(i&&m(e),J(e,s));i=s}else if(t.nodeType){if(Array.isArray(i)){if(o)return i=m(e,i,r,t);m(e,i,null,t)}else i==null||i===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);i=t}}return i}function F(e,t,i,r){let n=!1;for(let l=0,o=t.length;l<o;l++){let s=t[l],u=i&&i[e.length],c;if(!(s==null||s===!0||s===!1))if((c=typeof s)=="object"&&s.nodeType)e.push(s);else if(Array.isArray(s))n=F(e,s,u)||n;else if(c==="function")if(r){for(;typeof s=="function";)s=s();n=F(e,Array.isArray(s)?s:[s],Array.isArray(u)?u:[u])||n}else e.push(s),n=!0;else{const d=String(s);u&&u.nodeType===3&&u.data===d?e.push(u):e.push(document.createTextNode(d))}}return n}function J(e,t,i=null){for(let r=0,n=t.length;r<n;r++)e.insertBefore(t[r],i)}function m(e,t,i,r){if(i===void 0)return e.textContent="";const n=r||document.createTextNode("");if(t.length){let l=!1;for(let o=t.length-1;o>=0;o--){const s=t[o];if(n!==s){const u=s.parentNode===e;!l&&!o?u?e.replaceChild(n,s):e.insertBefore(n,i):u&&s.remove()}else l=!0}}else e.insertBefore(n,i);return[n]}const E=class E{constructor(){throw new Error(function(){return E.DISPLAY_ERROR(E.CODE.EINSTANTIATE)}())}static DISPLAY_ERROR(t){let i="";return Object.entries(t).map(([r,n],l)=>{l>0?i+=`${n}`:i+=`${r} ${n} - `}),i}};g(E,"CODE",{WEBGPU:{ERROR_CODE:1,TEXT:"The browser in used does not support WebGPU. May I suggest using Chrome 113 and above. Thank you."},EINSTANTIATE:{ERROR_CODE:2,TEXT:"Should/Cannot instantiate a static class"}});let q=E;var Q=L("<div>"),Te=L("<div><button>Click Me to refresh simulation");class Oe{constructor(){g(this,"_canvas");g(this,"context");g(this,"_pElem");g(this,"_webGpuSupported");g(this,"GRID_SIZE",32);g(this,"currentAnimationFrameID");g(this,"cellStateArray");g(this,"device");g(this,"cellStateStorage");let t=document.createElement("canvas");t.id="responsive-canvas",this._webGpuSupported=!0,navigator.gpu||(this._webGpuSupported=!1);let i=document.createElement("p");i.innerHTML=q.CODE.WEBGPU.TEXT,this._pElem=i,this._canvas=t;const r=this._canvas.getContext("webgpu");this.context=r,this.cellStateArray=new Uint32Array(this.GRID_SIZE*this.GRID_SIZE),this.currentAnimationFrameID=1,this.cellStateStorage=[],this.device=null}async setup(){var t=1.5;this._canvas.height=this._canvas.width*t;let i=0,r=this.GRID_SIZE;const n=await navigator.gpu.requestAdapter();if(!n)throw new Error("No appropriate GPUAdapter found.");this.device=await n.requestDevice();const l=new Float32Array([r,r]),o=this.device.createBuffer({label:"Grid Uniforms",size:l.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});if(this.device.queue.writeBuffer(o,0,l),this.context==null){this._webGpuSupported=!1;return}const s=navigator.gpu.getPreferredCanvasFormat();this.context.configure({device:this.device,format:s});const u=new Float32Array([-.8,-.8,.8,-.8,.8,.8,-.8,-.8,.8,.8,-.8,.8]),c=this.device.createBuffer({label:"Cell vertices",size:u.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST});this.device.queue.writeBuffer(c,0,u);const d={arrayStride:8,attributes:[{format:"float32x2",offset:0,shaderLocation:0}]};this.cellStateStorage=[this.device.createBuffer({label:"Cell State A",size:this.cellStateArray.byteLength,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),this.device.createBuffer({label:"Cell State B",size:this.cellStateArray.byteLength,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST})];for(let p=0;p<this.cellStateArray.length;p++)this.cellStateArray[p]=Math.random()>.6?1:0;this.device.queue.writeBuffer(this.cellStateStorage[0],0,this.cellStateArray);for(let p=0;p<this.cellStateArray.length;p++)this.cellStateArray[p]=p%2;this.device.queue.writeBuffer(this.cellStateStorage[1],0,this.cellStateArray);const S=this.device.createShaderModule({label:"Cell shader",code:`
                struct VertexInput {
                    @location(0) pos: vec2f,
                    @builtin(instance_index) instance: u32,
                };

                struct VertexOutput{
                    @builtin(position) pos : vec4f,
                    @location(0) cell: vec2f
                };
                
                @group(0) @binding(0) var<uniform> grid: vec2f;
                @group(0) @binding(1) var<storage> cellState: array<u32>;

                @vertex
                fn vertexMain(input: VertexInput) -> VertexOutput {
                    let i = f32(input.instance); // Save the instance as a float
                    let cell = vec2f(i%grid.x,floor(i/grid.x));
                    let state = f32(cellState[input.instance]);

                    let cellOffset = cell/grid * 2; //compute the offset to cell
                    let gridPos = (input.pos*state+1)/grid - 1 + cellOffset;

                    var output: VertexOutput;
                    output.pos = vec4f(gridPos,0,1); // (X,Y,Z,W)
                    output.cell = cell;
                    return output;
                }

                struct FragInput{
                    @location(0) cell:vec2f
                }

                @fragment
                fn fragmentMain(input:VertexOutput) -> @location(0) vec4f {
                    let c = input.cell / grid;
                    return vec4f(c,1-c.x,1);//(Red, Green, Blue, Alpha)
                }
            `}),y=8,G=this.device.createShaderModule({label:"Game of Life simulation shader",code:`
            
            
            @group(0) @binding(0) var<uniform> grid: vec2f;

            @group(0) @binding(1) var<storage> cellStateIn:array<u32>;
            @group(0) @binding(2) var<storage, read_write> cellStateOut: array<u32>;

            fn cellIndex(cell:vec2u) -> u32{
                return (cell.y % u32(grid.y))*u32(grid.x) + (cell.x % u32(grid.x));
            }

            fn cellActive(x:u32,y:u32) -> u32{
                return cellStateIn[cellIndex(vec2(x,y))];
            }

            @compute @workgroup_size(${y},${y})
            fn computeMain(@builtin(global_invocation_id) cell:vec3u) {
                
                let activeNeighbors = cellActive(cell.x+1, cell.y+1) +
                                cellActive(cell.x+1, cell.y) +
                                cellActive(cell.x+1, cell.y-1) +
                                cellActive(cell.x, cell.y-1) +
                                cellActive(cell.x-1, cell.y-1) +
                                cellActive(cell.x-1, cell.y) +
                                cellActive(cell.x-1, cell.y+1) +
                                cellActive(cell.x, cell.y+1);

                let i = cellIndex(cell.xy);
                switch activeNeighbors{
                    case 2:{
                        cellStateOut[i] = cellStateIn[i];
                    }
                    case 3:{
                        cellStateOut[i] = 1;
                    }
                    default:{
                        cellStateOut[i] = 0;
                    }
                    
                }
            }
            `}),w=this.device.createBindGroupLayout({label:"Cell Bind Group Layout",entries:[{binding:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.COMPUTE|GPUShaderStage.FRAGMENT,buffer:{}},{binding:1,visibility:GPUShaderStage.VERTEX|GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}}]}),k=this.device.createPipelineLayout({label:"Cell Pipeline Layout",bindGroupLayouts:[w]}),le=this.device.createComputePipeline({label:"Simulation pipeline",layout:k,compute:{module:G,entryPoint:"computeMain"}}),se=this.device.createRenderPipeline({label:"Cell pipeline",layout:k,vertex:{module:S,entryPoint:"vertexMain",buffers:[d]},fragment:{module:S,entryPoint:"fragmentMain",targets:[{format:s}]}}),W=[this.device.createBindGroup({label:"Cell renderer bind group A",layout:w,entries:[{binding:0,resource:{buffer:o}},{binding:1,resource:{buffer:this.cellStateStorage[0]}},{binding:2,resource:{buffer:this.cellStateStorage[1]}}]}),this.device.createBindGroup({label:"Cell renderer bind group B",layout:w,entries:[{binding:0,resource:{buffer:o}},{binding:1,resource:{buffer:this.cellStateStorage[1]}},{binding:2,resource:{buffer:this.cellStateStorage[0]}}]})];var X=0,oe=200,ue=1e3/oe;let ce=this.context,R=this;function j(p){if(R.currentAnimationFrameID=requestAnimationFrame(j),p-X<ue)return;X=p;const $=R.device.createCommandEncoder(),T=$.beginComputePass();T.setPipeline(le),T.setBindGroup(0,W[i%2]);const Y=Math.ceil(r/y);T.dispatchWorkgroups(Y,Y),T.end(),i++;const A=$.beginRenderPass({colorAttachments:[{view:ce.getCurrentTexture().createView(),loadOp:"clear",clearValue:{r:0,g:0,b:.4,a:1},storeOp:"store"}]});A.setPipeline(se),A.setBindGroup(0,W[i%2]),A.setVertexBuffer(0,c),A.draw(u.length/2,r*r),A.end();const ae=$.finish();R.device.queue.submit([ae])}this.currentAnimationFrameID=requestAnimationFrame(j)}get canvasElem(){return this._canvas}get pElem(){return this._pElem}get webGpuSupported(){return this._webGpuSupported}get currentFrameID(){return this.currentAnimationFrameID}reset(){for(let t=0;t<this.cellStateArray.length;t++)this.cellStateArray[t]=Math.random()>.6?1:0;this.device.queue.writeBuffer(this.cellStateStorage[0],0,this.cellStateArray),this.device.queue.writeBuffer(this.cellStateStorage[1],0,this.cellStateArray)}}function Be(){let e=new Oe;return e.webGpuSupported&&e.setup(),[(()=>{var t=Q();return M(t,V(Ee,{get when(){return e.webGpuSupported},get fallback(){return(()=>{var i=Q();return M(i,()=>e.pElem),i})()},get children(){return e.canvasElem}})),t})(),(()=>{var t=Te(),i=t.firstChild;return i.$$click=()=>{e.reset()},t})()]}Ce(["click"]);var _e=L("<h1>Justin Ng Wei Shung"),Ie=L("<p>Resume at LinkedIn Profile <a href=https://www.linkedin.com/in/justin-ng-wei-shung/>https://www.linkedin.com/in/justin-ng-wei-shung/");function Ue(){return[_e(),Ie(),V(Be,{})]}const Le=document.getElementById("root");Pe(()=>V(Ue,{}),Le);
